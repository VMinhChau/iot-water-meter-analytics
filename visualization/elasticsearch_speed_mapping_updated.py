from elasticsearch import Elasticsearch\nimport json\n\nclass ElasticsearchSpeedSetup:\n    def __init__(self, host='localhost:9200'):\n        self.es = Elasticsearch([host])\n    \n    def create_speed_index_mapping(self):\n        \"\"\"Create index mapping for speed layer data\"\"\"\n        mapping = {\n            \"mappings\": {\n                \"properties\": {\n                    \"meter_id\": {\"type\": \"long\"},\n                    \"window_start\": {\"type\": \"date\"},\n                    \"window_end\": {\"type\": \"date\"},\n                    \"measurement_type\": {\"type\": \"keyword\"},\n                    \"total_value\": {\"type\": \"double\"},\n                    \"avg_value\": {\"type\": \"double\"},\n                    \"reading_count\": {\"type\": \"long\"},\n                    \"suburb\": {\"type\": \"keyword\"},\n                    \"meter_type\": {\"type\": \"keyword\"},\n                    \"usage_type\": {\"type\": \"keyword\"}\n                }\n            }\n        }\n        \n        try:\n            self.es.indices.create(index=\"water-meter-speed\", body=mapping)\n            print(\"Speed layer index created successfully\")\n        except Exception as e:\n            print(f\"Speed index may already exist: {e}\")\n    \n    def create_alerts_index_mapping(self):\n        \"\"\"Create index mapping for alerts\"\"\"\n        mapping = {\n            \"mappings\": {\n                \"properties\": {\n                    \"meter_id\": {\"type\": \"long\"},\n                    \"timestamp\": {\"type\": \"date\"},\n                    \"measurement_type\": {\"type\": \"keyword\"},\n                    \"value\": {\"type\": \"double\"},\n                    \"alert_type\": {\"type\": \"keyword\"},\n                    \"suburb\": {\"type\": \"keyword\"},\n                    \"meter_type\": {\"type\": \"keyword\"},\n                    \"usage_type\": {\"type\": \"keyword\"},\n                    \"severity\": {\"type\": \"keyword\"}\n                }\n            }\n        }\n        \n        try:\n            self.es.indices.create(index=\"water-meter-alerts\", body=mapping)\n            print(\"Alerts index created successfully\")\n        except Exception as e:\n            print(f\"Alerts index may already exist: {e}\")\n    \n    def index_sample_speed_data(self):\n        \"\"\"Index sample speed layer data (enriched)\"\"\"\n        sample_docs = [\n            {\n                \"meter_id\": 83008,\n                \"window_start\": \"2022-07-13T07:30:00.000Z\",\n                \"window_end\": \"2022-07-13T07:35:00.000Z\",\n                \"measurement_type\": \"Pulse1\",\n                \"total_value\": 15.0,\n                \"avg_value\": 3.0,\n                \"reading_count\": 5,\n                \"suburb\": \"BUDERIM\",\n                \"meter_type\": \"captis_pulse\",\n                \"usage_type\": \"Residential\"\n            }\n        ]\n        \n        for doc in sample_docs:\n            self.es.index(index=\"water-meter-speed\", body=doc)\n        \n        print(\"Sample speed data indexed\")\n    \n    def index_sample_alert_data(self):\n        \"\"\"Index sample alert data\"\"\"\n        sample_alerts = [\n            {\n                \"meter_id\": 48281097,\n                \"timestamp\": \"2022-07-13T07:30:01.000Z\",\n                \"measurement_type\": \"Pulse1\",\n                \"value\": 460.0,\n                \"alert_type\": \"HIGH_FLOW\",\n                \"suburb\": \"MAROOCHYDORE\",\n                \"meter_type\": \"captis_pulse\",\n                \"usage_type\": \"Non-Residential\",\n                \"severity\": \"WARNING\"\n            }\n        ]\n        \n        for alert in sample_alerts:\n            self.es.index(index=\"water-meter-alerts\", body=alert)\n        \n        print(\"Sample alert data indexed\")\n\nif __name__ == \"__main__\":\n    setup = ElasticsearchSpeedSetup()\n    setup.create_speed_index_mapping()\n    setup.create_alerts_index_mapping()\n    setup.index_sample_speed_data()\n    setup.index_sample_alert_data()